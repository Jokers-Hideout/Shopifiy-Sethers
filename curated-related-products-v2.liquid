{% comment %}
  Curated Related Products (v2) â€” FINAL
  Uses product.metafields.custom.related_products_curated (List of product references)
{% endcomment %}

{% liquid
  assign related_list = product.metafields.custom.related_products_curated.value
%}

{% if related_list != blank %}
<section id="section-{{ section.id }}" class="collection-products curated-related-products curated-related-products--v2">
  <div class="container">
    <h2 class="section_title">{{ section.settings.heading }}</h2>

    <div class="collection-products__grid-wrapper grid-uniform" role="list">
      {%- assign shown = 0 -%}
      {%- for related in related_list -%}
        {%- if related and related.id != product.id -%}
          {%- assign _original_product = product -%}
          {%- assign product = related -%}

          {%- if section.settings.card_snippet == 'grid_navigation' -%}
            {%- render 'product-grid-navigation', product: product -%}
          {%- else -%}
            {%- render 'product-grid-item',
              product: product,
              product_list_class: "large--one-sixth medium--one-third small--one-half margin--bottom-15",
              mobile_product_list_class: "grid_less_padding"
            -%}
          {%- endif -%}

          {%- assign product = _original_product -%}
          {%- assign shown = shown | plus: 1 -%}
          {%- if shown >= section.settings.max_items -%}{% break %}{% endif -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>

  <style>
    /* Section spacing / optional divider */
    #section-{{ section.id }}{
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
    {% unless section.settings.hide_border_bottom %}
      #section-{{ section.id }}{ border-bottom: 1px solid rgba(0,0,0,.08); }
    {% endunless %}

    /* Enforce 6 / 3 / 2 columns â€” local to this section */
    @media (min-width: 990px){
      #section-{{ section.id }} .large--one-sixth{ width:16.6667% !important; float:left; }
    }
    @media (min-width: 750px) and (max-width: 989px){
      #section-{{ section.id }} .medium--one-third{ width:33.3333% !important; float:left; }
    }
    @media (max-width: 749px){
      #section-{{ section.id }} .small--one-half{ width:50% !important; float:left; }
    }
    #section-{{ section.id }} .collection-products__grid-wrapper.grid-uniform::after{
      content:""; display:block; clear:both;
    }

    /* ðŸš« Hide quick-buy / add-to-cart overlays inside this curated section only */
    #section-{{ section.id }} .grid__product-content .add_to_cart_form,
    #section-{{ section.id }} .grid__product-content .add-to-cart,
    #section-{{ section.id }} .grid__product-content .quick-buy,
    #section-{{ section.id }} .grid__product-content .product-tile--tile-actions,
    #section-{{ section.id }} .grid__product-content form[action*="/cart/add"],
    #section-{{ section.id }} .grid_collection_box .add-to-cart,
    #section-{{ section.id }} .grid_collection_box .quickview{
      display:none !important;
    }

    /* Match Recently Viewed card styling */
    #section-{{ section.id }} .grid__product-content h4{ margin-top:8px; text-align:center; font-size:14px; line-height:1.4; }
    #section-{{ section.id }} .price-section{ margin-top:4px; text-align:center; }
    #section-{{ section.id }} .grid__product-image img{ border-radius:6px; box-shadow:0 1px 3px rgba(0,0,0,.08); }
  </style>
</section>
{% endif %}

{% schema %}
{
  "name": "Related Products v2",
  "tag": "section",
  "class": "curated-related-products curated-related-products--v2",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Related Products" },
    { "type": "select", "id": "card_snippet", "label": "Product card to use", "options": [
      { "value": "grid_item", "label": "Theme card: product-grid-item" },
      { "value": "grid_navigation", "label": "Theme card: product-grid-navigation" }
    ], "default": "grid_item" },
    { "type": "range", "id": "max_items", "label": "Maximum products to show", "min": 6, "max": 24, "step": 6, "default": 12 },
    { "type": "checkbox", "id": "hide_border_bottom", "label": "Hide border-bottom on this section", "default": false },
    { "type": "range", "id": "padding_top", "label": "Section padding top (px)", "min": 0, "max": 100, "step": 4, "default": 32 },
    { "type": "range", "id": "padding_bottom", "label": "Section padding bottom (px)", "min": 0, "max": 100, "step": 4, "default": 32 }
  ],
  "presets": [
    { "name": "Related Products v2" }
  ]
}
{% endschema %}